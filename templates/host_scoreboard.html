{% extends "base_no_text.html" %}
{% block content %}
<h2>
    <span style="float: left">Practice Contest Platform</span>
    <span style="float: right">Game Code: {{ id }}</span>
</h2> 

<table>
    <thead>
        <tr>
            <th>Rank</th>
            <th style="width: 20%">Name</th>
            <th>Score</th>
            {% for problem in problems %}
            <th>{{ loop.index }}</th>
            {% endfor %}
        </tr>    
    </thead>
    <tbody id="player-list">
    </tbody>
</table>
<h2><center>Time Remaining</center></h2>
<body>
    <h1><center id="timer" style="padding: 10px; border: 2px solid black;"></center></h1>
</body>
<div id="panic-inducer" style="position:absolute;z-index:-1;left:0;top:0;width:100vw;height:100vh;background-color:red;opacity:0"></div>
<script>

    var totalTime = 1 * 60; //in seconds
    var duration = totalTime; //in seconds

    function update() {

        if (duration >= 0){
            hours = parseInt(duration / 3600, 10)
            minutes = parseInt(duration / 60 % 60, 10);
            seconds = parseInt(duration % 60, 10);
    
            hours = hours < 10 ? "0" + hours : hours;
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
    
            document.getElementById("timer").innerHTML =  hours + ":" + minutes + ":" + seconds;
    
            duration--;
        }
        console.log(parseFloat(duration) / parseFloat(totalTime));
        if ( parseFloat(duration) / parseFloat(totalTime) < 0.5){
            document.getElementById("panic-inducer").style.opacity = 1 - 2 * parseFloat(duration) / parseFloat(totalTime);
        }

        if (duration >= 0){

            //update table
            fetch("/api/players?id={{ id }}")
                .then(response => response.json())
                .then(function(players){
                    for (let player of players) {
                        player.push(player[2].reduce((a, b) => a + b, 0));
                    }
                    players.sort((a, b) => b[3] - a[3]);

                    document.getElementById("player-list").innerHTML = "";
                    for (let i=0; i<players.length; i++) {
                        let row = document.createElement("tr");
                        if (i == 0){
                            row.innerHTML = `
                            <td style="color:#E6AB21;"> ${i+1}</td>
                            <td style="color:#E6AB21;"><b>${players[i][1]}</b></td>
                            <td style="color:#000000;">${players[i][3]}</td>
                            `;
                        }

                        if (i == 1){
                            row.innerHTML = `
                            <td style="color:#D81159;"> ${i+1}</td>
                            <td style="color:#D81159;"><b>${players[i][1]}</b></td>
                            <td style="color:#000000;">${players[i][3]}</td>
                            `;
                        }

                        if (i == 2){
                            row.innerHTML = `
                            <td style="color:#324376;"> ${i+1}</td>
                            <td style="color:#324376;"><b>${players[i][1]}</b></td>
                            <td style="color:#000000;">${players[i][3]}</td>
                            `;
                        }

                        if (i > 2){
                            row.innerHTML = `
                            <td> ${i+1}</td>
                            <td><b> ${players[i][1]}</b></td>
                            <td> ${players[i][3]}</td>
                            `;
                        }

                        for (let j=0; j<players[i][2].length; j++) {
                            let cell = document.createElement("td");
                            cell.innerHTML = players[i][2][j];
                            row.appendChild(cell);
                        }   
                        document.getElementById("player-list").appendChild(row);
                    }
                });

<<<<<<< HEAD
        }
=======
                    for (let j=0; j<players[i][2].length; j++) {
                        let cell = document.createElement("td");
                        cell.innerHTML = players[i][2][j];
                        if (players[i][2][j] == 100) {
                            cell.className = "prob success";
                        }
                        else if (players[i][2][j] > 0) {
                            cell.className = "prob partial";
                        }
                        else if (players[i][2][j] == 0) {
                            cell.className = "prob";
                        }
                        else {
                            cell.className = "prob fail";
                        }
                        row.appendChild(cell);
                    }
                    document.getElementById("player-list").appendChild(row);
                }
            });
>>>>>>> cdbab59be3b0f55032baf1a50a0bcbebbead2eab
    }
    setInterval(update, 1000);
    update();
</script>
{% endblock %}